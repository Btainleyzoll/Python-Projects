import json
def load_nvd():
    
    with open('nvdcve-2.0-modified.json', 'r', encoding='utf-8') as f:
        nvd_data = json.load(f)
        return nvd_data
    



def extract_cpes(cve):
    cpes = []
    configs = cve.get("cve", {}).get("configurations", [])
    for config in configs:
        for node in config.get("nodes", []):
            for cpe in node.get("cpeMatch", []):
                if cpe.get("vulnerable"):
                    cpes.append(cpe["criteria"])

    return cpes

def parse_cpe(cpes):
    parsed = []
    for x in cpes:
        cutup = x.split(":")
        if len(cutup) >= 6:
            
            parsed.append({"part":cutup[2], 
                           "vendor":cutup[3], 
                           "product":cutup[4], 
                           "version":cutup[5]
                           })
    return parsed    
        
        
      
def matcher(port_info, parsed_cpe):
    matches = []
    
    service_name = port_info.get("service", "").lower()
    service_version = port_info.get("version", "").lower()
    
    for cpe in parsed_cpe:
        if cpe["product"].lower() in service_name and cpe["version"].lower() == service_version:
            matches.append(cpe)
    return matches

            
            
            
cpes = [
    "cpe:2.3:a:phoenixcontact-software:multiprog:5.0:*:*:*:*:*:*:*",
    "cpe:2.3:a:apache:http_server:2.4.49:*:*:*:*:*:*:*"
]

print(parse_cpe(cpes))